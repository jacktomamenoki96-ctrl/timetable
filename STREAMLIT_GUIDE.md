# Streamlit時間割生成アプリの使い方

## サンプルデータの使用

`sample_data/` ディレクトリに用意されたCSVファイルを使って、すぐにアプリを試すことができます。

### ファイル一覧

- `teachers.csv` - 8名の教員データ
- `rooms.csv` - 11の教室（普通教室6、特別教室5）
- `classes.csv` - 3クラス（1A, 1B, 1C）
- `lessons.csv` - 24科目（各クラス8科目）

### アプリの起動方法

```bash
cd /home/ryogoyamamoto/timetable-engine
streamlit run app.py
```

ブラウザが自動で開き、Webアプリが表示されます。

### 使い方

1. **CSVファイルのアップロード**
   - 各ファイルアップローダーに `sample_data/` フォルダ内のCSVファイルをドラッグ&ドロップ
   - または「Browse files」ボタンからファイルを選択

2. **設定の調整（オプション）**
   - サイドバーでソルバーの種類や最大試行回数を変更可能
   - デフォルト設定のままでも問題なし

3. **時間割生成**
   - 「🚀 時間割生成開始」ボタンをクリック
   - 数秒〜数十秒で時間割が生成されます

4. **結果の確認**
   - 「📊 全体」タブ: 全授業の一覧
   - 「📝 クラス別」タブ: クラスごとの週間時間割（表形式）
   - 「👨‍🏫 教員別」タブ: 教員ごとの週間予定
   - 「💾 ダウンロード」タブ: Excelファイルのダウンロード

## カスタムCSVの作成

独自のデータで時間割を生成する場合は、以下の形式でCSVファイルを作成してください。

### teachers.csv
| カラム名 | 説明 | 必須 |
|---------|------|------|
| teacher_id | 教員ID | ✅ |
| teacher_name | 教員名 | ✅ |
| availability_matrix | 担当可能時間（セミコロン区切り） | ❌ |

### rooms.csv
| カラム名 | 説明 | 必須 | 値 |
|---------|------|------|-----|
| room_id | 教室ID | ✅ | - |
| room_name | 教室名 | ✅ | - |
| room_type | 教室タイプ | ✅ | general, science, gym, music, art, computer, home_ec |
| capacity | 定員 | ✅ | 数値 |

### classes.csv
| カラム名 | 説明 | 必須 |
|---------|------|------|
| class_id | クラスID | ✅ |
| class_name | クラス名 | ✅ |
| size | 生徒数 | ✅ |

### lessons.csv
| カラム名 | 説明 | 必須 | 備考 |
|---------|------|------|------|
| lesson_id | 授業ID | ✅ | - |
| subject | 科目名 | ✅ | - |
| units | 週単位数 | ✅ | 1-6 |
| teacher_ids | 担当教員ID | ✅ | カンマ区切り可 |
| class_ids | 対象クラスID | ✅ | カンマ区切り可 |
| room_type | 必要教室タイプ | ✅ | roomsのroom_typeと一致 |
| synchronization_id | 同期ID | ❌ | 選択科目用 |

## トラブルシューティング

### 時間割が生成できない場合

1. **データを確認**
   - 週単位数の合計が30を超えていないか（各クラス）
   - 教員の数が十分か（教員1人あたり週30コマまで）
   - 教室の数が十分か（特に特別教室）

2. **設定を調整**
   - バックトラック法の場合: 最大試行回数を増やす（50000など）
   - OR-Toolsの場合: タイムアウト時間を延ばす（300秒など）

3. **データを簡略化**
   - まずクラス数を減らして試す
   - 週単位数を減らす
